# Plan 08-02: Push Notifications & PWA Polish

## Objective

Implement Web Push notifications for breaking news alerts and complete PWA polish with app-like experience enhancements.

## Current State Analysis

**Already Implemented:**
- Service worker with broadcast channel
- PWA manifest with app shortcuts
- Offline page with retry functionality

**Gaps to Address:**
1. No push notification subscription flow
2. No notification permission UI
3. Missing VAPID key generation
4. No server-side notification sending
5. PWA install prompt not customized
6. Offline page needs Clemson branding update

## Execution Context

```
@frontend/app/sw.enhanced.ts - Service worker (add push handler)
@frontend/app/layout.tsx - Root layout (add install prompt)
@frontend/lib/push-notifications.ts - New file for push logic
@frontend/components/NotificationPrompt.tsx - New component
@frontend/app/offline/page.tsx - Offline page styling
```

## Tasks

### 1. Generate VAPID Keys
- [ ] Generate VAPID key pair for Web Push
- [ ] Store public key in environment variable
- [ ] Document private key storage for backend

### 2. Create Push Notification Library
- [ ] Create `frontend/lib/push-notifications.ts`
- [ ] Implement subscription request function
- [ ] Implement permission check function
- [ ] Implement subscription storage (localStorage for now)

### 3. Add Push Handler to Service Worker
- [ ] Add push event listener in sw.enhanced.ts
- [ ] Handle notification display with Clemson branding
- [ ] Add notification click handler for deep linking
- [ ] Handle notification close events

### 4. Create Notification Permission UI
- [ ] Create NotificationPrompt component
- [ ] Design non-intrusive banner/toast
- [ ] Add "Enable Breaking News Alerts" CTA
- [ ] Handle permission states (granted, denied, default)

### 5. Integrate Notification Prompt
- [ ] Add prompt to homepage (after first visit)
- [ ] Store user preference in localStorage
- [ ] Respect "Don't ask again" preference
- [ ] Show in-app notification bell icon

### 6. Update Offline Page Styling
- [ ] Apply Clemson orange/purple branding
- [ ] Add team logo or sports imagery
- [ ] Update messaging for sports context
- [ ] Add "cached articles" section if available

### 7. Custom PWA Install Prompt
- [ ] Capture beforeinstallprompt event
- [ ] Create custom install banner component
- [ ] Show at appropriate time (not immediately)
- [ ] Track install metrics

### 8. Test PWA Features
- [ ] Test push notifications (manual trigger)
- [ ] Test offline functionality
- [ ] Test PWA install flow
- [ ] Test on mobile devices

## Verification

```bash
# Test push notifications locally
# Use browser DevTools > Application > Service Workers > Push

# Test offline mode
# DevTools > Network > Offline checkbox

# Test install prompt
# Chrome DevTools > Application > Manifest > Install button
```

## Success Criteria

- [ ] Push notification permission flow works
- [ ] Notifications display with Clemson branding
- [ ] Clicking notification opens relevant article
- [ ] Offline page shows Clemson styling
- [ ] PWA install prompt appears appropriately
- [ ] All PWA features work on Chrome and Safari

## Output

- New lib/push-notifications.ts
- New components/NotificationPrompt.tsx
- Updated sw.enhanced.ts with push handler
- Updated offline/page.tsx with Clemson styling
- Environment variables for VAPID keys documented

## Notes

- Push notifications require HTTPS in production
- Safari has different push notification implementation
- Consider user timing - don't prompt immediately on first visit
- Backend integration for sending notifications is out of scope for this plan
